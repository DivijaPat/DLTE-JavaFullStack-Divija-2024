

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="bootstrap-link">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loans</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.3.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" th:href="@{/styles/dashboard.css}" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

<!-- JavaScript libraries -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.3.3/js/bootstrap.min.js"></script>

<!-- Custom JavaScript -->
<script>
    $(document).ready(() => {

        const insuranceData = [];
        let currentPage = 1;
        const cardsPerPage = 8;
        let totalPages = 0; // Initialize totalPages
        window.appendDataToForm = function(index) {
            // Get data from modal fields using unique IDs based on the index
            const insuranceID = document.getElementById(`insuranceID${index}`).value;
            const insuranceType = document.getElementById(`insuranceType${index}`).value;
            const insuranceName = document.getElementById(`insuranceName${index}`).value;
            const insuranceKeyBenefits = document.getElementById(`insuranceKeyBenefits${index}`).value;
            const insuranceLifetime = document.getElementById(`insuranceLifetime${index}`).value;

            // Create a new form data object
            const formData = new FormData();

            // Append data to the form data object
            formData.append('insuranceID', insuranceID);
            formData.append('insuranceType', insuranceType);
            formData.append('insuranceName', insuranceName);
            formData.append('insuranceKeyBenefits', insuranceKeyBenefits);
            formData.append('insuranceLifetime', insuranceLifetime);

            // Redirect to the applyInsurance.html page with appended data
            window.location.href = '../ui/apply?' + new URLSearchParams(formData).toString();
        }



        const fetchInsuranceById = (minLimit, maxLimit) => {
        insuranceData.length = 0; // Clear existing insurance data

        // Fetch data via REST API
        $.ajax({
            url: `/module/insurance/${minLimit}/${maxLimit}`,
            type: "GET",
            success: function(response) {
                console.log(response)
                const insurance = response;
                // Extract insurance details
                const insurancepremium = insurance.INSURANCE_PREMIUM;
                const insuranceType = insurance.INSURANCE_TYPE;
                const insuranceName = insurance.INSURANCE_NAME;
                const insuranceKeyBenefits = insurance.INSURANCE_KEY_BENEFITS;
                const insuranceLifetime = insurance.INSURANCE_LIFETIME;

                insuranceData.push({insurancepremium,insuranceType,insuranceName,insuranceKeyBenefits,insuranceLifetime})

                generateInsuranceCards();
            },
            error: function(xhr, status, error) {
                console.error("Error fetching insurance data:", error);
                if (xhr.status === 404) {
                    alert("Insurance not found.");
                } else {
                    alert("An error occurred while fetching insurance data.");
                }
            }
        });
    };



    const generateInsuranceCards = () => {
        const containerHeight = 2000; // Fixed container height (adjust as needed)
        const cardHeight = 250; // Approximate height of each card
        const maxCardsPerPage = Math.floor(containerHeight / cardHeight); // Calculate max cards per page

        $("#insuranceCards").empty();
        $("#modalContent").empty();

        // Calculate start and end indexes for current page
        const startIndex = (currentPage - 1) * maxCardsPerPage;
        const endIndex = Math.min(startIndex + maxCardsPerPage, insuranceData.length);

        // Loop through data and generate cards for current page
        for (let i = startIndex; i < endIndex; i++) {
            if (i >= insuranceData.length) break; // Exit loop if reached end of data

            const insurance = insuranceData[i];
            let cardHtml = `
            <div class="col">
                <div class="card text-white p-2 me-4 shadow-lg" data-bs-toggle="modal" data-bs-target="#cardModal${i}">
                    <div class="card-header border-3 text-center">${insurance.insuranceType}</div>
                    <div class="card-body card-content">
                        <h5 class="card-title text-center">${insurance.insuranceName}</h5>
                        <p class="card-text text-center fst-poppins">${insurance.insuranceKeyBenefits}</p>
                    </div>
                </div>
            </div>`;

            $("#insuranceCards").append(cardHtml);

            let modalHtml = `
            <div class="modal fade" id="cardModal${i}" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="cardModalLabel">Detailed View</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card text-white ">
                                <div class="card-header fst-montserrat">${insurance.insuranceType}</div>
                                <div class="card-body">
                                    <h3 class="card-title fst-poppins">${insurance.insuranceName}</h3>
                                    <h5 class="card-body">
                                        <p class="card-text fst-poppins">Insurance ID: ${insurance.insurancepremium}</p>
                                        <p class="card-text fst-poppins">Insurance Type: ${insurance.insuranceType}</p>
                                        <p class="card-text fst-poppins">Key Benefits: ${insurance.insuranceKeyBenefits}</p>
                                        <p class="card-text font-poppins">Insurance Lifetime: ${insurance.insuranceLifetime}</p>
                                    </h5>
                        <input type="hidden" id="insuranceID${i}" value="${insurance.insuranceID}">
                        <input type="hidden" id="insuranceType${i}" value="${insurance.insuranceType}">
                        <input type="hidden" id="insuranceName${i}" value="${insurance.insuranceName}">
                        <input type="hidden" id="insuranceKeyBenefits${i}" value="${insurance.insuranceKeyBenefits}">
                        <input type="hidden" id="insuranceLifetime${i}" value="${insurance.insuranceLifetime}">
                        <button type="button" onclick="appendDataToForm(${i})" class="apply">Apply Insurance</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

            $("#modalContent").append(modalHtml);
        }

        generatePageNumbers();
    };



    // Function to handle pagination
    const handlePagination = (direction) => {
        if (direction === 'next') {
            currentPage++;
        } else if (direction === 'prev') {
            currentPage--;
        }
        generateInsuranceCards();
    };

    // Function to generate page numbers
    const generatePageNumbers = () => {
        let pageNumberHtml = '';
        pageNumberHtml += `<span class="page-number page-link border-2">${currentPage}</span>`;
        $('#pageNumberContainer').html(pageNumberHtml);
        // Highlight the current page number
        $(`#pageNumberContainer .page-number[data-page="${currentPage}"]`).addClass('active');
    };

    // Event listener for next page button
    $('#nextPage').click(() => {
        if (currentPage < totalPages) {

            handlePagination('next');
            updatePaginationButtons();
        }
    });

    // Event listener for previous page button
    $('#prevPage').click(() => {
        if (currentPage > 1) {

            handlePagination('prev');
            updatePaginationButtons();
        }
    });

    $("#searchByCoverage").click(() => {
        const max = $("#maxLimit").val();
        const min = $("#minLimit").val();

        // Get the value of insurance ID input field
            fetchInsuranceById(min,max); // Call the function to fetch insurance details by ID
    });



    // Function to update pagination buttons visibility
    const updatePaginationButtons = () => {
        if (currentPage === 1) {
            $('#prevPage').addClass('d-none');
        } else {
            $('#prevPage').removeClass('d-none');
        }

        if (currentPage === totalPages) {
            $('#nextPage').addClass('d-none');
        } else {
            $('#nextPage').removeClass('d-none');
        }
    };

    // Call the function initially to set the initial visibility
    updatePaginationButtons();

    });
</script>
<div class="container-fluid col-10 ">
    <div class="row">
        <div class="col card-container">
            <div id="insuranceCards" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4 me-4"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <!-- Pagination -->
            <nav aria-label="Insurance Pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item">
                        <a class="page-link" href="#" id="prevPage" aria-label="Previous">
                            <span class="bi bi-chevron-left" aria-hidden="true"></span>
                        </a>
                    </li>
                    <li id="pageNumberContainer" class="page-item "></li>
                    <!-- Dynamically generated page numbers will go here -->
                    <li class="page-item">
                        <a class="page-link" href="#" id="nextPage" aria-label="Next">
                            <span class="bi bi-chevron-right" aria-hidden="true"></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- Page number container -->
    <div id="modalContent"></div>
</div>



</div>

</body>
</html>
